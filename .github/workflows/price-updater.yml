name: Price Updater

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª GitHub Actions)
    - cron: '*/5 * * * *'
  
  # –†–∞–∑—Ä–µ—à–∞–µ–º —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  workflow_dispatch:

jobs:
  update-prices:
    runs-on: ubuntu-latest
    
    steps:
    - name: Trigger price update
      run: |
        # URL –≤–∞—à–µ–≥–æ production —Å–µ—Ä–≤–∏—Å–∞
        # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω –∏–ª–∏ LoadBalancer IP
        SERVICE_URL="${{ secrets.PRICE_SERVICE_URL || 'http://your-service-domain.com' }}"
        
        echo "üöÄ Triggering price update at $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –∑–∞–ø—Ä–æ—Å
        HTTP_CODE=$(curl -s -o /tmp/response.json -w "%{http_code}" \
          -X POST \
          -H "Content-Type: application/json" \
          -H "User-Agent: GitHub-Actions-PriceUpdater/1.0" \
          -m 30 \
          "$SERVICE_URL/pricing/trigger-update")
        
        echo "üìä HTTP Status: $HTTP_CODE"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞
        if [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 300 ]; then
          echo "‚úÖ Price update completed successfully"
          cat /tmp/response.json
        else
          echo "‚ùå Price update failed with HTTP $HTTP_CODE"
          cat /tmp/response.json
          exit 1
        fi
    
    - name: Notify on failure
      if: failure()
      run: |
        echo "‚ö†Ô∏è Price update failed at $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Slack/Discord/Telegram

